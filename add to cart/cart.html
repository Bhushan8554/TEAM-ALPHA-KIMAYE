<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      #imgProduct {
        width: 80px;
      }
      #qty {
        padding: 0 10px;
        border: 1px solid black;
      }
      #btnDec,#btnInc {
        border: none;
        margin: 5px;
        box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
      }
    </style>
  </head>
  <body>
    <div class="cart">
      <div class="heading">
        <p>SHOPPING CART</p>
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th>product</th>
          <th>quantity</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="subtotal">
      <p>subtotal:</p>
      <p>0</p>
    </div>
  </body>
</html>
<script>
  let cartArr = JSON.parse(localStorage.getItem("cartArr")) || [];
  // console.log(cartArr)
  let tbody = document.querySelector("tbody");

  let totalQuantity = 0;
  let totalPrice = 0;
  let sPrice = 0;
  displayCart(cartArr);

  function displayCart(cartArr) {
    cartArr.forEach(function (item, index) {
      let x = item.price;
      x = x.split("â‚¹");
      x = x.splice(1, 1).map(Number);
      x = x.join();

      let tr = document.createElement("tr");
      let td1 = document.createElement("td");
      let img = document.createElement("img");
      img.setAttribute("src", item.img);
      img.setAttribute("id","imgProduct")
      td1.append(img);
      tr.append(td1);

      td2 = document.createElement("td");
      let name = document.createElement("p");
      name.innerText = item.product;
      let price = document.createElement("small");
      price.innerText = item.price;
      let br = document.createElement("br");

      // dec button
      let decBtn = document.createElement("button");
      decBtn.innerText = "-";
      decBtn.setAttribute("id","btnDec")
      decBtn.addEventListener("click", decrease);

      // dec function
      function decrease(item) {
        if (qty > 1) {
          qty--;
          totalQuantity -= 1;
          quantity.innerText = qty;
          sPrice = +x;
          let total = x * qty;
          td4.innerText = total;
          decreaseDisplayTotalPrice(sPrice);
          
        }
      }
      // quantity

      let quantity = document.createElement("small");
      let qty = 1;
      quantity.setAttribute("id", "qty");
      totalQuantity += qty;
      quantity.innerText = +qty;
    //   localStorage.setItem("qty", q)

      //   inc button

      let incBtn = document.createElement("button");
      incBtn.innerText = "+";
      incBtn.setAttribute("id","btnInc")
      incBtn.addEventListener("click", function () {
        increase();
      });

      //   inc function

      function increase() {
        qty++;
        if (qty >= 1) {
          quantity.innerText = qty;
          totalQuantity += 1;
          sPrice = +x;
          total = x * qty;
          td4.innerText = total;
          increaseDisplayTotalPrice(sPrice);
        }
      }
      //   delete button
      td3 = document.createElement("button");
      td3.innerText = "DELETE";
      td3.addEventListener("click", function () {
        delete_item(index);
      });

      //   total single
      let td4 = document.createElement("td");
      let total = x * qty;
      totalPrice += total;
      td4.innerText = total;

      td2.append(name, price, br, decBtn, quantity, incBtn);
      tr.append(td2);
      tr.append(td3, td4);
      tbody.append(tr);
    });
  }

  //   total price
  function displayTotalPrice() {
    let totalText = document.querySelector(".subtotal>p+p");
    totalText.innerText = totalPrice;
  }
  displayTotalPrice();

  // total after decrease
  function decreaseDisplayTotalPrice(sPrice) {
    let totalText = document.querySelector(".subtotal>p+p");
    let oldprice = totalText.innerText;
    totalText.innerText = +oldprice - sPrice;
  }
  // total  after increase
  function increaseDisplayTotalPrice(sPrice) {
    let totalText = document.querySelector(".subtotal>p+p");
    let oldprice = totalText.innerText;
    totalText.innerText = +oldprice + sPrice;
  }

  //   delete function
  function delete_item(index) {
    cartArr.splice(index, 1);

    localStorage.setItem("cartArr", JSON.stringify(cartArr));
    window.location.reload();
  }
</script>
